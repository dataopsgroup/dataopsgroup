<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Static Content Delivery Test - DataOps Group</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    .test-results { background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; }
    .success { border-left: 4px solid #4caf50; }
    .warning { border-left: 4px solid #ff9800; }
    .error { border-left: 4px solid #f44336; }
    button { background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:hover { background: #1565c0; }
    pre { background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 300px; }
    .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .metric { background: white; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0; }
  </style>
</head>
<body>
  <h1>üß™ Static Content Delivery Test</h1>
  <p>Validate that static HTML files are properly delivered to crawlers and AI tools.</p>
  
  <div class="test-section">
    <h2>Direct Static File Tests</h2>
    <p>Test direct access to static HTML files:</p>
    <button onclick="testDirectStatic('/static/homepage.html')">Homepage Static</button>
    <button onclick="testDirectStatic('/static/services.html')">Services Static</button>
    <button onclick="testDirectStatic('/static/hubspot-expert-guide.html')">Guide Static</button>
    <button onclick="testDirectStatic('/static/dataops-implementation.html')">DataOps Static</button>
    <button onclick="testDirectStatic('/static/analytics-bi.html')">Analytics Static</button>
  </div>
  
  <div class="test-section">
    <h2>Bot User Agent Tests</h2>
    <p>Test how content is delivered to different bots:</p>
    <select id="botUserAgent">
      <option value="Googlebot/2.1 (+http://www.google.com/bot.html)">Googlebot</option>
      <option value="Mozilla/5.0 (compatible; ChatGPT-User/1.0; +https://openai.com/bot)">ChatGPT</option>
      <option value="Mozilla/5.0 (compatible; Claude-Web/1.0; +https://anthropic.com)">Claude</option>
      <option value="Mozilla/5.0 (compatible; PerplexityBot/1.0; +https://perplexity.ai)">Perplexity</option>
      <option value="ccbot/2.0 (https://commoncrawl.org/faq/)">CCBot (Common Crawl)</option>
    </select>
    <br>
    <button onclick="testWithBot('/')">Test Homepage</button>
    <button onclick="testWithBot('/services')">Test Services</button>
    <button onclick="testWithBot('/guides/hubspot-expert')">Test Guide</button>
  </div>
  
  <div class="test-section">
    <h2>Content Quality Analysis</h2>
    <div id="qualityMetrics" class="metrics"></div>
  </div>
  
  <div id="results"></div>
  
  <div class="test-section">
    <h2>Debugging Commands</h2>
    <p>Use these commands to test from command line:</p>
    <pre id="debugCommands">
# Test direct static file access
curl -v "https://dataopsgroup.com/static/homepage.html"

# Test with Googlebot user agent
curl -H "User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)" -v "https://dataopsgroup.com/"

# Test with AI crawler user agent
curl -H "User-Agent: Mozilla/5.0 (compatible; ChatGPT-User/1.0)" -v "https://dataopsgroup.com/services"

# Check for binary corruption
curl -s "https://dataopsgroup.com/" | file -

# Test response headers
curl -I "https://dataopsgroup.com/static/homepage.html"
    </pre>
  </div>

  <script>
    let testResults = [];
    
    async function testDirectStatic(path) {
      const resultsDiv = document.getElementById('results');
      const testResult = document.createElement('div');
      testResult.className = 'test-results';
      testResult.innerHTML = `<h3>Testing Direct Static: ${path}</h3><p>‚è≥ Loading...</p>`;
      resultsDiv.appendChild(testResult);
      
      try {
        const response = await fetch(path, {
          cache: 'no-cache',
          headers: {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
          }
        });
        
        const content = await response.text();
        const analysis = analyzeContent(content, response);
        
        testResult.className = `test-results ${analysis.status}`;
        testResult.innerHTML = `
          <h3>Direct Static Test: ${path}</h3>
          <p><strong>Status:</strong> ${analysis.statusMessage}</p>
          <p><strong>Content-Type:</strong> ${response.headers.get('Content-Type')}</p>
          <p><strong>Content-Length:</strong> ${content.length} characters</p>
          <p><strong>X-Served-By:</strong> ${response.headers.get('X-Served-By') || 'Not set'}</p>
          <p><strong>Readable Content:</strong> ${analysis.hasReadableContent ? 'Yes ‚úÖ' : 'No ‚ùå'}</p>
          <p><strong>Binary Issues:</strong> ${analysis.hasBinaryIssues ? 'Yes ‚ùå' : 'No ‚úÖ'}</p>
          <details>
            <summary>Content Preview</summary>
            <pre>${analysis.preview}</pre>
          </details>
        `;
        
        testResults.push({ path, type: 'direct', ...analysis });
        updateQualityMetrics();
        
      } catch (error) {
        testResult.className = 'test-results error';
        testResult.innerHTML = `<h3>Error: ${path}</h3><p>‚ùå ${error.message}</p>`;
      }
    }
    
    async function testWithBot(path) {
      const botSelect = document.getElementById('botUserAgent');
      const userAgent = botSelect.value;
      const resultsDiv = document.getElementById('results');
      
      const testResult = document.createElement('div');
      testResult.className = 'test-results';
      testResult.innerHTML = `<h3>Testing Bot Access: ${path}</h3><p>User-Agent: ${userAgent.substring(0, 50)}...</p><p>‚è≥ Loading...</p>`;
      resultsDiv.appendChild(testResult);
      
      try {
        const response = await fetch(path, {
          cache: 'no-cache',
          headers: {
            'User-Agent': userAgent,
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
          }
        });
        
        const content = await response.text();
        const analysis = analyzeContent(content, response);
        
        testResult.className = `test-results ${analysis.status}`;
        testResult.innerHTML = `
          <h3>Bot Test: ${path}</h3>
          <p><strong>Status:</strong> ${analysis.statusMessage}</p>
          <p><strong>Content-Source:</strong> ${response.headers.get('X-Content-Source') || 'Unknown'}</p>
          <p><strong>Served-By:</strong> ${response.headers.get('X-Served-By') || 'Unknown'}</p>
          <p><strong>Content Length:</strong> ${content.length} characters</p>
          <p><strong>Is JavaScript Bundle:</strong> ${analysis.isJSBundle ? 'Yes ‚ùå' : 'No ‚úÖ'}</p>
          <p><strong>Readable Content:</strong> ${analysis.hasReadableContent ? 'Yes ‚úÖ' : 'No ‚ùå'}</p>
          <p><strong>Binary Issues:</strong> ${analysis.hasBinaryIssues ? 'Yes ‚ùå' : 'No ‚úÖ'}</p>
          <details>
            <summary>Content Preview</summary>
            <pre>${analysis.preview}</pre>
          </details>
        `;
        
        testResults.push({ path, type: 'bot', userAgent, ...analysis });
        updateQualityMetrics();
        
      } catch (error) {
        testResult.className = 'test-results error';
        testResult.innerHTML = `<h3>Error: ${path}</h3><p>‚ùå ${error.message}</p>`;
      }
    }
    
    function analyzeContent(content, response) {
      const hasBinaryIssues = /[\x00-\x08\x0B\x0C\x0E-\x1F\uFFFD]/.test(content);
      const hasReadableContent = content.includes('<h1>') && content.includes('<p>') && content.length > 100;
      const isJSBundle = content.includes('React') || content.includes('__vite') || content.includes('import{');
      const hasProperContentType = response.headers.get('Content-Type')?.includes('text/html');
      const hasCharset = response.headers.get('Content-Type')?.includes('charset=utf-8');
      
      let status = 'success';
      let statusMessage = '‚úÖ Perfect - Clean HTML content delivered';
      
      if (hasBinaryIssues) {
        status = 'error';
        statusMessage = '‚ùå Binary corruption detected';
      } else if (isJSBundle) {
        status = 'error';
        statusMessage = '‚ùå JavaScript bundle served instead of HTML';
      } else if (!hasReadableContent) {
        status = 'warning';
        statusMessage = '‚ö†Ô∏è Limited readable content';
      } else if (!hasProperContentType || !hasCharset) {
        status = 'warning';
        statusMessage = '‚ö†Ô∏è Missing proper content type headers';
      }
      
      const preview = content.substring(0, 300).replace(/</g, '&lt;').replace(/>/g, '&gt;');
      
      return {
        status,
        statusMessage,
        hasBinaryIssues,
        hasReadableContent,
        isJSBundle,
        hasProperContentType,
        hasCharset,
        preview: preview + '...'
      };
    }
    
    function updateQualityMetrics() {
      const metricsDiv = document.getElementById('qualityMetrics');
      const total = testResults.length;
      const successful = testResults.filter(r => r.status === 'success').length;
      const warnings = testResults.filter(r => r.status === 'warning').length;
      const errors = testResults.filter(r => r.status === 'error').length;
      const jsIssues = testResults.filter(r => r.isJSBundle).length;
      
      metricsDiv.innerHTML = `
        <div class="metric">
          <h4>Success Rate</h4>
          <p style="font-size: 24px; color: #4caf50;">${total > 0 ? Math.round((successful / total) * 100) : 0}%</p>
          <small>${successful}/${total} tests passed</small>
        </div>
        <div class="metric">
          <h4>Content Quality</h4>
          <p style="font-size: 24px; color: ${jsIssues === 0 ? '#4caf50' : '#f44336'};">${jsIssues === 0 ? 'Clean' : 'Issues'}</p>
          <small>${jsIssues} JS bundle detections</small>
        </div>
        <div class="metric">
          <h4>Warnings</h4>
          <p style="font-size: 24px; color: #ff9800;">${warnings}</p>
          <small>Header or encoding issues</small>
        </div>
        <div class="metric">
          <h4>Errors</h4>
          <p style="font-size: 24px; color: #f44336;">${errors}</p>
          <small>Binary corruption or JS bundles</small>
        </div>
      `;
    }
    
    // Update debug commands with current domain
    const debugCommands = document.getElementById('debugCommands');
    const domain = window.location.origin;
    debugCommands.textContent = `
# Test direct static file access
curl -v "${domain}/static/homepage.html"

# Test with Googlebot user agent
curl -H "User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)" -v "${domain}/"

# Test with AI crawler user agent
curl -H "User-Agent: Mozilla/5.0 (compatible; ChatGPT-User/1.0)" -v "${domain}/services"

# Check for binary corruption
curl -s "${domain}/" | file -

# Test response headers
curl -I "${domain}/static/homepage.html"
    `;
  </script>
</body>
</html>